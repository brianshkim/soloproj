{"ast":null,"code":"'use strict';\n\nexports.parse = function (source, transform) {\n  return new ArrayParser(source, transform).parse();\n};\n\nclass ArrayParser {\n  constructor(source, transform) {\n    this.source = source;\n    this.transform = transform || identity;\n    this.position = 0;\n    this.entries = [];\n    this.recorded = [];\n    this.dimension = 0;\n  }\n\n  isEof() {\n    return this.position >= this.source.length;\n  }\n\n  nextCharacter() {\n    var character = this.source[this.position++];\n\n    if (character === '\\\\') {\n      return {\n        value: this.source[this.position++],\n        escaped: true\n      };\n    }\n\n    return {\n      value: character,\n      escaped: false\n    };\n  }\n\n  record(character) {\n    this.recorded.push(character);\n  }\n\n  newEntry(includeEmpty) {\n    var entry;\n\n    if (this.recorded.length > 0 || includeEmpty) {\n      entry = this.recorded.join('');\n\n      if (entry === 'NULL' && !includeEmpty) {\n        entry = null;\n      }\n\n      if (entry !== null) entry = this.transform(entry);\n      this.entries.push(entry);\n      this.recorded = [];\n    }\n  }\n\n  consumeDimensions() {\n    if (this.source[0] === '[') {\n      while (!this.isEof()) {\n        var char = this.nextCharacter();\n        if (char.value === '=') break;\n      }\n    }\n  }\n\n  parse(nested) {\n    var character, parser, quote;\n    this.consumeDimensions();\n\n    while (!this.isEof()) {\n      character = this.nextCharacter();\n\n      if (character.value === '{' && !quote) {\n        this.dimension++;\n\n        if (this.dimension > 1) {\n          parser = new ArrayParser(this.source.substr(this.position - 1), this.transform);\n          this.entries.push(parser.parse(true));\n          this.position += parser.position - 2;\n        }\n      } else if (character.value === '}' && !quote) {\n        this.dimension--;\n\n        if (!this.dimension) {\n          this.newEntry();\n          if (nested) return this.entries;\n        }\n      } else if (character.value === '\"' && !character.escaped) {\n        if (quote) this.newEntry(true);\n        quote = !quote;\n      } else if (character.value === ',' && !quote) {\n        this.newEntry();\n      } else {\n        this.record(character.value);\n      }\n    }\n\n    if (this.dimension !== 0) {\n      throw new Error('array dimension not balanced');\n    }\n\n    return this.entries;\n  }\n\n}\n\nfunction identity(value) {\n  return value;\n}","map":{"version":3,"names":["exports","parse","source","transform","ArrayParser","constructor","identity","position","entries","recorded","dimension","isEof","length","nextCharacter","character","value","escaped","record","push","newEntry","includeEmpty","entry","join","consumeDimensions","char","nested","parser","quote","substr","Error"],"sources":["/home/brian/node_modules/postgres-array/index.js"],"sourcesContent":["'use strict'\n\nexports.parse = function (source, transform) {\n  return new ArrayParser(source, transform).parse()\n}\n\nclass ArrayParser {\n  constructor (source, transform) {\n    this.source = source\n    this.transform = transform || identity\n    this.position = 0\n    this.entries = []\n    this.recorded = []\n    this.dimension = 0\n  }\n\n  isEof () {\n    return this.position >= this.source.length\n  }\n\n  nextCharacter () {\n    var character = this.source[this.position++]\n    if (character === '\\\\') {\n      return {\n        value: this.source[this.position++],\n        escaped: true\n      }\n    }\n    return {\n      value: character,\n      escaped: false\n    }\n  }\n\n  record (character) {\n    this.recorded.push(character)\n  }\n\n  newEntry (includeEmpty) {\n    var entry\n    if (this.recorded.length > 0 || includeEmpty) {\n      entry = this.recorded.join('')\n      if (entry === 'NULL' && !includeEmpty) {\n        entry = null\n      }\n      if (entry !== null) entry = this.transform(entry)\n      this.entries.push(entry)\n      this.recorded = []\n    }\n  }\n\n  consumeDimensions () {\n    if (this.source[0] === '[') {\n      while (!this.isEof()) {\n        var char = this.nextCharacter()\n        if (char.value === '=') break\n      }\n    }\n  }\n\n  parse (nested) {\n    var character, parser, quote\n    this.consumeDimensions()\n    while (!this.isEof()) {\n      character = this.nextCharacter()\n      if (character.value === '{' && !quote) {\n        this.dimension++\n        if (this.dimension > 1) {\n          parser = new ArrayParser(this.source.substr(this.position - 1), this.transform)\n          this.entries.push(parser.parse(true))\n          this.position += parser.position - 2\n        }\n      } else if (character.value === '}' && !quote) {\n        this.dimension--\n        if (!this.dimension) {\n          this.newEntry()\n          if (nested) return this.entries\n        }\n      } else if (character.value === '\"' && !character.escaped) {\n        if (quote) this.newEntry(true)\n        quote = !quote\n      } else if (character.value === ',' && !quote) {\n        this.newEntry()\n      } else {\n        this.record(character.value)\n      }\n    }\n    if (this.dimension !== 0) {\n      throw new Error('array dimension not balanced')\n    }\n    return this.entries\n  }\n}\n\nfunction identity (value) {\n  return value\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}