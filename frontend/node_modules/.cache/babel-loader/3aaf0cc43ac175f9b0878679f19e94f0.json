{"ast":null,"code":"'use strict';\n\nvar Promise = require('any-promise');\n\nvar util = require('util');\n\nvar format = util.format;\n\nfunction TimeoutError(message, err) {\n  Error.call(this);\n  Error.captureStackTrace(this, TimeoutError);\n  this.name = 'TimeoutError';\n  this.message = message;\n  this.previous = err;\n}\n\nutil.inherits(TimeoutError, Error);\n\nfunction matches(match, err) {\n  if (match === true) return true;\n\n  if (typeof match === 'function') {\n    try {\n      if (err instanceof match) return true;\n    } catch (_) {\n      return !!match(err);\n    }\n  }\n\n  if (match === err.toString()) return true;\n  if (match === err.message) return true;\n  return match instanceof RegExp && (match.test(err.message) || match.test(err.toString()));\n}\n\nmodule.exports = function retryAsPromised(callback, options) {\n  if (!callback || !options) {\n    throw new Error('retry-as-promised must be passed a callback and a options set or a number');\n  }\n\n  if (typeof options === 'number') {\n    options = {\n      max: options\n    };\n  } // Super cheap clone\n\n\n  options = {\n    $current: options.$current || 1,\n    max: options.max,\n    timeout: options.timeout || undefined,\n    match: options.match || [],\n    backoffBase: options.backoffBase === undefined ? 100 : options.backoffBase,\n    backoffExponent: options.backoffExponent || 1.1,\n    report: options.report || function () {},\n    name: options.name || callback.name || 'unknown'\n  };\n  if (!Array.isArray(options.match)) options.match = [options.match];\n  options.report('Trying ' + options.name + ' #' + options.$current + ' at ' + new Date().toLocaleTimeString(), options);\n  return new Promise(function (resolve, reject) {\n    var timeout, backoffTimeout, lastError;\n\n    if (options.timeout) {\n      timeout = setTimeout(function () {\n        if (backoffTimeout) clearTimeout(backoffTimeout);\n        reject(new TimeoutError(options.name + ' timed out', lastError));\n      }, options.timeout);\n    }\n\n    Promise.resolve(callback({\n      current: options.$current\n    })).then(resolve).then(function () {\n      if (timeout) clearTimeout(timeout);\n      if (backoffTimeout) clearTimeout(backoffTimeout);\n    }).catch(function (err) {\n      if (timeout) clearTimeout(timeout);\n      if (backoffTimeout) clearTimeout(backoffTimeout);\n      lastError = err;\n      options.report(err && err.toString() || err, options); // Should not retry if max has been reached\n\n      var shouldRetry = options.$current < options.max;\n      if (!shouldRetry) return reject(err);\n      shouldRetry = options.match.length === 0 || options.match.some(function (match) {\n        return matches(match, err);\n      });\n      if (!shouldRetry) return reject(err);\n      var retryDelay = Math.pow(options.backoffBase, Math.pow(options.backoffExponent, options.$current - 1)); // Do some accounting\n\n      options.$current++;\n      options.report(format('Retrying %s (%s)', options.name, options.$current), options);\n\n      if (retryDelay) {\n        // Use backoff function to ease retry rate\n        options.report(format('Delaying retry of %s by %s', options.name, retryDelay), options);\n        backoffTimeout = setTimeout(function () {\n          retryAsPromised(callback, options).then(resolve).catch(reject);\n        }, retryDelay);\n      } else {\n        retryAsPromised(callback, options).then(resolve).catch(reject);\n      }\n    });\n  });\n};\n\nmodule.exports.TimeoutError = TimeoutError;","map":{"version":3,"names":["Promise","require","util","format","TimeoutError","message","err","Error","call","captureStackTrace","name","previous","inherits","matches","match","_","toString","RegExp","test","module","exports","retryAsPromised","callback","options","max","$current","timeout","undefined","backoffBase","backoffExponent","report","Array","isArray","Date","toLocaleTimeString","resolve","reject","backoffTimeout","lastError","setTimeout","clearTimeout","current","then","catch","shouldRetry","length","some","retryDelay","Math","pow"],"sources":["/home/brian/node_modules/retry-as-promised/index.js"],"sourcesContent":["'use strict';\n\nvar Promise = require('any-promise');\nvar util = require('util');\nvar format = util.format;\n\nfunction TimeoutError(message, err) {\n  Error.call(this);\n  Error.captureStackTrace(this, TimeoutError);\n  this.name = 'TimeoutError';\n  this.message = message;\n  this.previous = err;\n}\n\nutil.inherits(TimeoutError, Error);\n\nfunction matches(match, err) {\n  if (match === true) return true;\n  if (typeof match === 'function') {\n    try {\n      if (err instanceof match) return true;\n    } catch (_) {\n      return !!match(err);\n    }\n  }\n  if (match === err.toString()) return true;\n  if (match === err.message) return true;\n  return match instanceof RegExp\n    && (match.test(err.message) || match.test(err.toString()));\n}\n\nmodule.exports = function retryAsPromised(callback, options) {\n  if (!callback || !options) {\n    throw new Error(\n      'retry-as-promised must be passed a callback and a options set or a number'\n    );\n  }\n\n  if (typeof options === 'number') {\n    options = {\n      max: options\n    };\n  }\n\n  // Super cheap clone\n  options = {\n    $current: options.$current || 1,\n    max: options.max,\n    timeout: options.timeout || undefined,\n    match: options.match || [],\n    backoffBase: options.backoffBase === undefined ? 100 : options.backoffBase,\n    backoffExponent: options.backoffExponent || 1.1,\n    report: options.report || function () {},\n    name: options.name || callback.name || 'unknown'\n  };\n\n  if (!Array.isArray(options.match)) options.match = [options.match];\n  options.report('Trying ' + options.name + ' #' + options.$current + ' at ' + new Date().toLocaleTimeString(), options);\n\n  return new Promise(function(resolve, reject) {\n    var timeout, backoffTimeout, lastError;\n\n    if (options.timeout) {\n      timeout = setTimeout(function() {\n        if (backoffTimeout) clearTimeout(backoffTimeout);\n        reject(new TimeoutError(options.name + ' timed out', lastError));\n      }, options.timeout);\n    }\n\n    Promise.resolve(callback({ current: options.$current }))\n      .then(resolve)\n      .then(function() {\n        if (timeout) clearTimeout(timeout);\n        if (backoffTimeout) clearTimeout(backoffTimeout);\n      })\n      .catch(function(err) {\n        if (timeout) clearTimeout(timeout);\n        if (backoffTimeout) clearTimeout(backoffTimeout);\n\n        lastError = err;\n        options.report((err && err.toString()) || err, options);\n\n        // Should not retry if max has been reached\n        var shouldRetry = options.$current < options.max;\n        if (!shouldRetry) return reject(err);\n        shouldRetry = options.match.length === 0 || options.match.some(function (match) {\n          return matches(match, err)\n        });\n        if (!shouldRetry) return reject(err);\n\n        var retryDelay = Math.pow(\n          options.backoffBase,\n          Math.pow(options.backoffExponent, options.$current - 1)\n        );\n\n        // Do some accounting\n        options.$current++;\n        options.report(format('Retrying %s (%s)', options.name, options.$current), options);\n\n        if (retryDelay) {\n          // Use backoff function to ease retry rate\n          options.report(format('Delaying retry of %s by %s', options.name, retryDelay), options);\n          backoffTimeout = setTimeout(function() {\n            retryAsPromised(callback, options)\n              .then(resolve)\n              .catch(reject);\n          }, retryDelay);\n        } else {\n          retryAsPromised(callback, options)\n            .then(resolve)\n            .catch(reject);\n        }\n      });\n  });\n};\n\nmodule.exports.TimeoutError = TimeoutError;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}