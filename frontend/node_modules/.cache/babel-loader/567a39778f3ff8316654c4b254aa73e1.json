{"ast":null,"code":"'use strict';\n\nconst _ = require('lodash');\n\nconst Utils = require('../../utils');\n\nconst AbstractQueryGenerator = require('../abstract/query-generator');\n\nconst util = require('util');\n\nconst Op = require('../../operators');\n\nconst jsonFunctionRegex = /^\\s*((?:[a-z]+_){0,2}jsonb?(?:_[a-z]+){0,2})\\([^)]*\\)/i;\nconst jsonOperatorRegex = /^\\s*(->>?|@>|<@|\\?[|&]?|\\|{2}|#-)/i;\nconst tokenCaptureRegex = /^\\s*((?:([`\"'])(?:(?!\\2).|\\2{2})*\\2)|[\\w\\d\\s]+|[().,;+-])/i;\nconst foreignKeyFields = 'CONSTRAINT_NAME as constraint_name,' + 'CONSTRAINT_NAME as constraintName,' + 'CONSTRAINT_SCHEMA as constraintSchema,' + 'CONSTRAINT_SCHEMA as constraintCatalog,' + 'TABLE_NAME as tableName,' + 'TABLE_SCHEMA as tableSchema,' + 'TABLE_SCHEMA as tableCatalog,' + 'COLUMN_NAME as columnName,' + 'REFERENCED_TABLE_SCHEMA as referencedTableSchema,' + 'REFERENCED_TABLE_SCHEMA as referencedTableCatalog,' + 'REFERENCED_TABLE_NAME as referencedTableName,' + 'REFERENCED_COLUMN_NAME as referencedColumnName';\nconst typeWithoutDefault = new Set(['BLOB', 'TEXT', 'GEOMETRY', 'JSON']);\n\nclass MySQLQueryGenerator extends AbstractQueryGenerator {\n  constructor(options) {\n    super(options);\n    this.OperatorMap = Object.assign({}, this.OperatorMap, {\n      [Op.regexp]: 'REGEXP',\n      [Op.notRegexp]: 'NOT REGEXP'\n    });\n  }\n\n  createDatabaseQuery(databaseName, options) {\n    options = Object.assign({\n      charset: null,\n      collate: null\n    }, options || {});\n    const database = this.quoteIdentifier(databaseName);\n    const charset = options.charset ? ` DEFAULT CHARACTER SET ${this.escape(options.charset)}` : '';\n    const collate = options.collate ? ` DEFAULT COLLATE ${this.escape(options.collate)}` : '';\n    return `${`CREATE DATABASE IF NOT EXISTS ${database}${charset}${collate}`.trim()};`;\n  }\n\n  dropDatabaseQuery(databaseName) {\n    return `DROP DATABASE IF EXISTS ${this.quoteIdentifier(databaseName).trim()};`;\n  }\n\n  createSchema() {\n    return 'SHOW TABLES';\n  }\n\n  showSchemasQuery() {\n    return 'SHOW TABLES';\n  }\n\n  versionQuery() {\n    return 'SELECT VERSION() as `version`';\n  }\n\n  createTableQuery(tableName, attributes, options) {\n    options = Object.assign({\n      engine: 'InnoDB',\n      charset: null,\n      rowFormat: null\n    }, options || {});\n    const primaryKeys = [];\n    const foreignKeys = {};\n    const attrStr = [];\n\n    for (const attr in attributes) {\n      if (!Object.prototype.hasOwnProperty.call(attributes, attr)) continue;\n      const dataType = attributes[attr];\n      let match;\n\n      if (dataType.includes('PRIMARY KEY')) {\n        primaryKeys.push(attr);\n\n        if (dataType.includes('REFERENCES')) {\n          // MySQL doesn't support inline REFERENCES declarations: move to the end\n          match = dataType.match(/^(.+) (REFERENCES.*)$/);\n          attrStr.push(`${this.quoteIdentifier(attr)} ${match[1].replace('PRIMARY KEY', '')}`);\n          foreignKeys[attr] = match[2];\n        } else {\n          attrStr.push(`${this.quoteIdentifier(attr)} ${dataType.replace('PRIMARY KEY', '')}`);\n        }\n      } else if (dataType.includes('REFERENCES')) {\n        // MySQL doesn't support inline REFERENCES declarations: move to the end\n        match = dataType.match(/^(.+) (REFERENCES.*)$/);\n        attrStr.push(`${this.quoteIdentifier(attr)} ${match[1]}`);\n        foreignKeys[attr] = match[2];\n      } else {\n        attrStr.push(`${this.quoteIdentifier(attr)} ${dataType}`);\n      }\n    }\n\n    const table = this.quoteTable(tableName);\n    let attributesClause = attrStr.join(', ');\n    const comment = options.comment && typeof options.comment === 'string' ? ` COMMENT ${this.escape(options.comment)}` : '';\n    const engine = options.engine;\n    const charset = options.charset ? ` DEFAULT CHARSET=${options.charset}` : '';\n    const collation = options.collate ? ` COLLATE ${options.collate}` : '';\n    const rowFormat = options.rowFormat ? ` ROW_FORMAT=${options.rowFormat}` : '';\n    const initialAutoIncrement = options.initialAutoIncrement ? ` AUTO_INCREMENT=${options.initialAutoIncrement}` : '';\n    const pkString = primaryKeys.map(pk => this.quoteIdentifier(pk)).join(', ');\n\n    if (options.uniqueKeys) {\n      _.each(options.uniqueKeys, (columns, indexName) => {\n        if (columns.customIndex) {\n          if (typeof indexName !== 'string') {\n            indexName = `uniq_${tableName}_${columns.fields.join('_')}`;\n          }\n\n          attributesClause += `, UNIQUE ${this.quoteIdentifier(indexName)} (${columns.fields.map(field => this.quoteIdentifier(field)).join(', ')})`;\n        }\n      });\n    }\n\n    if (pkString.length > 0) {\n      attributesClause += `, PRIMARY KEY (${pkString})`;\n    }\n\n    for (const fkey in foreignKeys) {\n      if (Object.prototype.hasOwnProperty.call(foreignKeys, fkey)) {\n        attributesClause += `, FOREIGN KEY (${this.quoteIdentifier(fkey)}) ${foreignKeys[fkey]}`;\n      }\n    }\n\n    return `CREATE TABLE IF NOT EXISTS ${table} (${attributesClause}) ENGINE=${engine}${comment}${charset}${collation}${initialAutoIncrement}${rowFormat};`;\n  }\n\n  describeTableQuery(tableName, schema, schemaDelimiter) {\n    const table = this.quoteTable(this.addSchema({\n      tableName,\n      _schema: schema,\n      _schemaDelimiter: schemaDelimiter\n    }));\n    return `SHOW FULL COLUMNS FROM ${table};`;\n  }\n\n  showTablesQuery(database) {\n    let query = 'SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = \\'BASE TABLE\\'';\n\n    if (database) {\n      query += ` AND TABLE_SCHEMA = ${this.escape(database)}`;\n    } else {\n      query += ' AND TABLE_SCHEMA NOT IN (\\'MYSQL\\', \\'INFORMATION_SCHEMA\\', \\'PERFORMANCE_SCHEMA\\', \\'SYS\\')';\n    }\n\n    return `${query};`;\n  }\n\n  addColumnQuery(table, key, dataType) {\n    const definition = this.attributeToSQL(dataType, {\n      context: 'addColumn',\n      tableName: table,\n      foreignKey: key\n    });\n    return `ALTER TABLE ${this.quoteTable(table)} ADD ${this.quoteIdentifier(key)} ${definition};`;\n  }\n\n  removeColumnQuery(tableName, attributeName) {\n    return `ALTER TABLE ${this.quoteTable(tableName)} DROP ${this.quoteIdentifier(attributeName)};`;\n  }\n\n  changeColumnQuery(tableName, attributes) {\n    const attrString = [];\n    const constraintString = [];\n\n    for (const attributeName in attributes) {\n      let definition = attributes[attributeName];\n\n      if (definition.includes('REFERENCES')) {\n        const attrName = this.quoteIdentifier(attributeName);\n        definition = definition.replace(/.+?(?=REFERENCES)/, '');\n        constraintString.push(`FOREIGN KEY (${attrName}) ${definition}`);\n      } else {\n        attrString.push(`\\`${attributeName}\\` \\`${attributeName}\\` ${definition}`);\n      }\n    }\n\n    let finalQuery = '';\n\n    if (attrString.length) {\n      finalQuery += `CHANGE ${attrString.join(', ')}`;\n      finalQuery += constraintString.length ? ' ' : '';\n    }\n\n    if (constraintString.length) {\n      finalQuery += `ADD ${constraintString.join(', ')}`;\n    }\n\n    return `ALTER TABLE ${this.quoteTable(tableName)} ${finalQuery};`;\n  }\n\n  renameColumnQuery(tableName, attrBefore, attributes) {\n    const attrString = [];\n\n    for (const attrName in attributes) {\n      const definition = attributes[attrName];\n      attrString.push(`\\`${attrBefore}\\` \\`${attrName}\\` ${definition}`);\n    }\n\n    return `ALTER TABLE ${this.quoteTable(tableName)} CHANGE ${attrString.join(', ')};`;\n  }\n\n  handleSequelizeMethod(smth, tableName, factory, options, prepend) {\n    if (smth instanceof Utils.Json) {\n      // Parse nested object\n      if (smth.conditions) {\n        const conditions = this.parseConditionObject(smth.conditions).map(condition => `${this.jsonPathExtractionQuery(condition.path[0], _.tail(condition.path))} = '${condition.value}'`);\n        return conditions.join(' AND ');\n      }\n\n      if (smth.path) {\n        let str; // Allow specifying conditions using the sqlite json functions\n\n        if (this._checkValidJsonStatement(smth.path)) {\n          str = smth.path;\n        } else {\n          // Also support json property accessors\n          const paths = _.toPath(smth.path);\n\n          const column = paths.shift();\n          str = this.jsonPathExtractionQuery(column, paths);\n        }\n\n        if (smth.value) {\n          str += util.format(' = %s', this.escape(smth.value));\n        }\n\n        return str;\n      }\n    } else if (smth instanceof Utils.Cast) {\n      if (/timestamp/i.test(smth.type)) {\n        smth.type = 'datetime';\n      } else if (smth.json && /boolean/i.test(smth.type)) {\n        // true or false cannot be casted as booleans within a JSON structure\n        smth.type = 'char';\n      } else if (/double precision/i.test(smth.type) || /boolean/i.test(smth.type) || /integer/i.test(smth.type)) {\n        smth.type = 'decimal';\n      } else if (/text/i.test(smth.type)) {\n        smth.type = 'char';\n      }\n    }\n\n    return super.handleSequelizeMethod(smth, tableName, factory, options, prepend);\n  }\n\n  _toJSONValue(value) {\n    // true/false are stored as strings in mysql\n    if (typeof value === 'boolean') {\n      return value.toString();\n    } // null is stored as a string in mysql\n\n\n    if (value === null) {\n      return 'null';\n    }\n\n    return value;\n  }\n\n  upsertQuery(tableName, insertValues, updateValues, where, model, options) {\n    options.onDuplicate = 'UPDATE ';\n    options.onDuplicate += Object.keys(updateValues).map(key => {\n      key = this.quoteIdentifier(key);\n      return `${key}=VALUES(${key})`;\n    }).join(', ');\n    return this.insertQuery(tableName, insertValues, model.rawAttributes, options);\n  }\n\n  truncateTableQuery(tableName) {\n    return `TRUNCATE ${this.quoteTable(tableName)}`;\n  }\n\n  deleteQuery(tableName, where) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    let model = arguments.length > 3 ? arguments[3] : undefined;\n    let limit = '';\n    let query = `DELETE FROM ${this.quoteTable(tableName)}`;\n\n    if (options.limit) {\n      limit = ` LIMIT ${this.escape(options.limit)}`;\n    }\n\n    where = this.getWhereConditions(where, null, model, options);\n\n    if (where) {\n      query += ` WHERE ${where}`;\n    }\n\n    return query + limit;\n  }\n\n  showIndexesQuery(tableName, options) {\n    return `SHOW INDEX FROM ${this.quoteTable(tableName)}${(options || {}).database ? ` FROM \\`${options.database}\\`` : ''}`;\n  }\n\n  showConstraintsQuery(table, constraintName) {\n    const tableName = table.tableName || table;\n    const schemaName = table.schema;\n    let sql = ['SELECT CONSTRAINT_CATALOG AS constraintCatalog,', 'CONSTRAINT_NAME AS constraintName,', 'CONSTRAINT_SCHEMA AS constraintSchema,', 'CONSTRAINT_TYPE AS constraintType,', 'TABLE_NAME AS tableName,', 'TABLE_SCHEMA AS tableSchema', 'from INFORMATION_SCHEMA.TABLE_CONSTRAINTS', `WHERE table_name='${tableName}'`].join(' ');\n\n    if (constraintName) {\n      sql += ` AND constraint_name = '${constraintName}'`;\n    }\n\n    if (schemaName) {\n      sql += ` AND TABLE_SCHEMA = '${schemaName}'`;\n    }\n\n    return `${sql};`;\n  }\n\n  removeIndexQuery(tableName, indexNameOrAttributes) {\n    let indexName = indexNameOrAttributes;\n\n    if (typeof indexName !== 'string') {\n      indexName = Utils.underscore(`${tableName}_${indexNameOrAttributes.join('_')}`);\n    }\n\n    return `DROP INDEX ${this.quoteIdentifier(indexName)} ON ${this.quoteTable(tableName)}`;\n  }\n\n  attributeToSQL(attribute, options) {\n    if (!_.isPlainObject(attribute)) {\n      attribute = {\n        type: attribute\n      };\n    }\n\n    const attributeString = attribute.type.toString({\n      escape: this.escape.bind(this)\n    });\n    let template = attributeString;\n\n    if (attribute.allowNull === false) {\n      template += ' NOT NULL';\n    }\n\n    if (attribute.autoIncrement) {\n      template += ' auto_increment';\n    } // BLOB/TEXT/GEOMETRY/JSON cannot have a default value\n\n\n    if (!typeWithoutDefault.has(attributeString) && attribute.type._binary !== true && Utils.defaultValueSchemable(attribute.defaultValue)) {\n      template += ` DEFAULT ${this.escape(attribute.defaultValue)}`;\n    }\n\n    if (attribute.unique === true) {\n      template += ' UNIQUE';\n    }\n\n    if (attribute.primaryKey) {\n      template += ' PRIMARY KEY';\n    }\n\n    if (attribute.comment) {\n      template += ` COMMENT ${this.escape(attribute.comment)}`;\n    }\n\n    if (attribute.first) {\n      template += ' FIRST';\n    }\n\n    if (attribute.after) {\n      template += ` AFTER ${this.quoteIdentifier(attribute.after)}`;\n    }\n\n    if (attribute.references) {\n      if (options && options.context === 'addColumn' && options.foreignKey) {\n        const attrName = this.quoteIdentifier(options.foreignKey);\n        const fkName = this.quoteIdentifier(`${options.tableName}_${attrName}_foreign_idx`);\n        template += `, ADD CONSTRAINT ${fkName} FOREIGN KEY (${attrName})`;\n      }\n\n      template += ` REFERENCES ${this.quoteTable(attribute.references.model)}`;\n\n      if (attribute.references.key) {\n        template += ` (${this.quoteIdentifier(attribute.references.key)})`;\n      } else {\n        template += ` (${this.quoteIdentifier('id')})`;\n      }\n\n      if (attribute.onDelete) {\n        template += ` ON DELETE ${attribute.onDelete.toUpperCase()}`;\n      }\n\n      if (attribute.onUpdate) {\n        template += ` ON UPDATE ${attribute.onUpdate.toUpperCase()}`;\n      }\n    }\n\n    return template;\n  }\n\n  attributesToSQL(attributes, options) {\n    const result = {};\n\n    for (const key in attributes) {\n      const attribute = attributes[key];\n      result[attribute.field || key] = this.attributeToSQL(attribute, options);\n    }\n\n    return result;\n  }\n  /**\n   * Check whether the statmement is json function or simple path\n   *\n   * @param   {string}  stmt  The statement to validate\n   * @returns {boolean}       true if the given statement is json function\n   * @throws  {Error}         throw if the statement looks like json function but has invalid token\n   * @private\n   */\n\n\n  _checkValidJsonStatement(stmt) {\n    if (typeof stmt !== 'string') {\n      return false;\n    }\n\n    let currentIndex = 0;\n    let openingBrackets = 0;\n    let closingBrackets = 0;\n    let hasJsonFunction = false;\n    let hasInvalidToken = false;\n\n    while (currentIndex < stmt.length) {\n      const string = stmt.substr(currentIndex);\n      const functionMatches = jsonFunctionRegex.exec(string);\n\n      if (functionMatches) {\n        currentIndex += functionMatches[0].indexOf('(');\n        hasJsonFunction = true;\n        continue;\n      }\n\n      const operatorMatches = jsonOperatorRegex.exec(string);\n\n      if (operatorMatches) {\n        currentIndex += operatorMatches[0].length;\n        hasJsonFunction = true;\n        continue;\n      }\n\n      const tokenMatches = tokenCaptureRegex.exec(string);\n\n      if (tokenMatches) {\n        const capturedToken = tokenMatches[1];\n\n        if (capturedToken === '(') {\n          openingBrackets++;\n        } else if (capturedToken === ')') {\n          closingBrackets++;\n        } else if (capturedToken === ';') {\n          hasInvalidToken = true;\n          break;\n        }\n\n        currentIndex += tokenMatches[0].length;\n        continue;\n      }\n\n      break;\n    } // Check invalid json statement\n\n\n    if (hasJsonFunction && (hasInvalidToken || openingBrackets !== closingBrackets)) {\n      throw new Error(`Invalid json statement: ${stmt}`);\n    } // return true if the statement has valid json function\n\n\n    return hasJsonFunction;\n  }\n  /**\n   * Generates an SQL query that returns all foreign keys of a table.\n   *\n   * @param  {Object} table  The table.\n   * @param  {string} schemaName The name of the schema.\n   * @returns {string}            The generated sql query.\n   * @private\n   */\n\n\n  getForeignKeysQuery(table, schemaName) {\n    const tableName = table.tableName || table;\n    return `SELECT ${foreignKeyFields} FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE where TABLE_NAME = '${tableName}' AND CONSTRAINT_NAME!='PRIMARY' AND CONSTRAINT_SCHEMA='${schemaName}' AND REFERENCED_TABLE_NAME IS NOT NULL;`;\n  }\n  /**\n   * Generates an SQL query that returns the foreign key constraint of a given column.\n   *\n   * @param  {Object} table  The table.\n   * @param  {string} columnName The name of the column.\n   * @returns {string}            The generated sql query.\n   * @private\n   */\n\n\n  getForeignKeyQuery(table, columnName) {\n    const quotedSchemaName = table.schema ? wrapSingleQuote(table.schema) : '';\n    const quotedTableName = wrapSingleQuote(table.tableName || table);\n    const quotedColumnName = wrapSingleQuote(columnName);\n    return `SELECT ${foreignKeyFields} FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE` + ` WHERE (REFERENCED_TABLE_NAME = ${quotedTableName}${table.schema ? ` AND REFERENCED_TABLE_SCHEMA = ${quotedSchemaName}` : ''} AND REFERENCED_COLUMN_NAME = ${quotedColumnName})` + ` OR (TABLE_NAME = ${quotedTableName}${table.schema ? ` AND TABLE_SCHEMA = ${quotedSchemaName}` : ''} AND COLUMN_NAME = ${quotedColumnName} AND REFERENCED_TABLE_NAME IS NOT NULL)`;\n  }\n  /**\n   * Generates an SQL query that removes a foreign key from a table.\n   *\n   * @param  {string} tableName  The name of the table.\n   * @param  {string} foreignKey The name of the foreign key constraint.\n   * @returns {string}            The generated sql query.\n   * @private\n   */\n\n\n  dropForeignKeyQuery(tableName, foreignKey) {\n    return `ALTER TABLE ${this.quoteTable(tableName)}\n      DROP FOREIGN KEY ${this.quoteIdentifier(foreignKey)};`;\n  }\n\n} // private methods\n\n\nfunction wrapSingleQuote(identifier) {\n  return Utils.addTicks(identifier, '\\'');\n}\n\nmodule.exports = MySQLQueryGenerator;","map":{"version":3,"names":["_","require","Utils","AbstractQueryGenerator","util","Op","jsonFunctionRegex","jsonOperatorRegex","tokenCaptureRegex","foreignKeyFields","typeWithoutDefault","Set","MySQLQueryGenerator","constructor","options","OperatorMap","Object","assign","regexp","notRegexp","createDatabaseQuery","databaseName","charset","collate","database","quoteIdentifier","escape","trim","dropDatabaseQuery","createSchema","showSchemasQuery","versionQuery","createTableQuery","tableName","attributes","engine","rowFormat","primaryKeys","foreignKeys","attrStr","attr","prototype","hasOwnProperty","call","dataType","match","includes","push","replace","table","quoteTable","attributesClause","join","comment","collation","initialAutoIncrement","pkString","map","pk","uniqueKeys","each","columns","indexName","customIndex","fields","field","length","fkey","describeTableQuery","schema","schemaDelimiter","addSchema","_schema","_schemaDelimiter","showTablesQuery","query","addColumnQuery","key","definition","attributeToSQL","context","foreignKey","removeColumnQuery","attributeName","changeColumnQuery","attrString","constraintString","attrName","finalQuery","renameColumnQuery","attrBefore","handleSequelizeMethod","smth","factory","prepend","Json","conditions","parseConditionObject","condition","jsonPathExtractionQuery","path","tail","value","str","_checkValidJsonStatement","paths","toPath","column","shift","format","Cast","test","type","json","_toJSONValue","toString","upsertQuery","insertValues","updateValues","where","model","onDuplicate","keys","insertQuery","rawAttributes","truncateTableQuery","deleteQuery","limit","getWhereConditions","showIndexesQuery","showConstraintsQuery","constraintName","schemaName","sql","removeIndexQuery","indexNameOrAttributes","underscore","attribute","isPlainObject","attributeString","bind","template","allowNull","autoIncrement","has","_binary","defaultValueSchemable","defaultValue","unique","primaryKey","first","after","references","fkName","onDelete","toUpperCase","onUpdate","attributesToSQL","result","stmt","currentIndex","openingBrackets","closingBrackets","hasJsonFunction","hasInvalidToken","string","substr","functionMatches","exec","indexOf","operatorMatches","tokenMatches","capturedToken","Error","getForeignKeysQuery","getForeignKeyQuery","columnName","quotedSchemaName","wrapSingleQuote","quotedTableName","quotedColumnName","dropForeignKeyQuery","identifier","addTicks","module","exports"],"sources":["/home/brian/node_modules/sequelize/lib/dialects/mysql/query-generator.js"],"sourcesContent":["'use strict';\n\nconst _ = require('lodash');\nconst Utils = require('../../utils');\nconst AbstractQueryGenerator = require('../abstract/query-generator');\nconst util = require('util');\nconst Op = require('../../operators');\n\n\nconst jsonFunctionRegex = /^\\s*((?:[a-z]+_){0,2}jsonb?(?:_[a-z]+){0,2})\\([^)]*\\)/i;\nconst jsonOperatorRegex = /^\\s*(->>?|@>|<@|\\?[|&]?|\\|{2}|#-)/i;\nconst tokenCaptureRegex = /^\\s*((?:([`\"'])(?:(?!\\2).|\\2{2})*\\2)|[\\w\\d\\s]+|[().,;+-])/i;\nconst foreignKeyFields = 'CONSTRAINT_NAME as constraint_name,'\n  + 'CONSTRAINT_NAME as constraintName,'\n  + 'CONSTRAINT_SCHEMA as constraintSchema,'\n  + 'CONSTRAINT_SCHEMA as constraintCatalog,'\n  + 'TABLE_NAME as tableName,'\n  + 'TABLE_SCHEMA as tableSchema,'\n  + 'TABLE_SCHEMA as tableCatalog,'\n  + 'COLUMN_NAME as columnName,'\n  + 'REFERENCED_TABLE_SCHEMA as referencedTableSchema,'\n  + 'REFERENCED_TABLE_SCHEMA as referencedTableCatalog,'\n  + 'REFERENCED_TABLE_NAME as referencedTableName,'\n  + 'REFERENCED_COLUMN_NAME as referencedColumnName';\n\nconst typeWithoutDefault = new Set(['BLOB', 'TEXT', 'GEOMETRY', 'JSON']);\n\nclass MySQLQueryGenerator extends AbstractQueryGenerator {\n  constructor(options) {\n    super(options);\n\n    this.OperatorMap = Object.assign({}, this.OperatorMap, {\n      [Op.regexp]: 'REGEXP',\n      [Op.notRegexp]: 'NOT REGEXP'\n    });\n  }\n\n  createDatabaseQuery(databaseName, options) {\n    options = Object.assign({\n      charset: null,\n      collate: null\n    }, options || {});\n\n    const database = this.quoteIdentifier(databaseName);\n    const charset = options.charset ? ` DEFAULT CHARACTER SET ${this.escape(options.charset)}` : '';\n    const collate = options.collate ? ` DEFAULT COLLATE ${this.escape(options.collate)}` : '';\n\n    return `${`CREATE DATABASE IF NOT EXISTS ${database}${charset}${collate}`.trim()};`;\n  }\n\n  dropDatabaseQuery(databaseName) {\n    return `DROP DATABASE IF EXISTS ${this.quoteIdentifier(databaseName).trim()};`;\n  }\n\n  createSchema() {\n    return 'SHOW TABLES';\n  }\n\n  showSchemasQuery() {\n    return 'SHOW TABLES';\n  }\n\n  versionQuery() {\n    return 'SELECT VERSION() as `version`';\n  }\n\n  createTableQuery(tableName, attributes, options) {\n    options = Object.assign({\n      engine: 'InnoDB',\n      charset: null,\n      rowFormat: null\n    }, options || {});\n\n    const primaryKeys = [];\n    const foreignKeys = {};\n    const attrStr = [];\n\n    for (const attr in attributes) {\n      if (!Object.prototype.hasOwnProperty.call(attributes, attr)) continue;\n      const dataType = attributes[attr];\n      let match;\n\n      if (dataType.includes('PRIMARY KEY')) {\n        primaryKeys.push(attr);\n\n        if (dataType.includes('REFERENCES')) {\n          // MySQL doesn't support inline REFERENCES declarations: move to the end\n          match = dataType.match(/^(.+) (REFERENCES.*)$/);\n          attrStr.push(`${this.quoteIdentifier(attr)} ${match[1].replace('PRIMARY KEY', '')}`);\n          foreignKeys[attr] = match[2];\n        } else {\n          attrStr.push(`${this.quoteIdentifier(attr)} ${dataType.replace('PRIMARY KEY', '')}`);\n        }\n      } else if (dataType.includes('REFERENCES')) {\n        // MySQL doesn't support inline REFERENCES declarations: move to the end\n        match = dataType.match(/^(.+) (REFERENCES.*)$/);\n        attrStr.push(`${this.quoteIdentifier(attr)} ${match[1]}`);\n        foreignKeys[attr] = match[2];\n      } else {\n        attrStr.push(`${this.quoteIdentifier(attr)} ${dataType}`);\n      }\n    }\n\n    const table = this.quoteTable(tableName);\n    let attributesClause = attrStr.join(', ');\n    const comment = options.comment && typeof options.comment === 'string' ? ` COMMENT ${this.escape(options.comment)}` : '';\n    const engine = options.engine;\n    const charset = options.charset ? ` DEFAULT CHARSET=${options.charset}` : '';\n    const collation = options.collate ? ` COLLATE ${options.collate}` : '';\n    const rowFormat = options.rowFormat ? ` ROW_FORMAT=${options.rowFormat}` : '';\n    const initialAutoIncrement = options.initialAutoIncrement ? ` AUTO_INCREMENT=${options.initialAutoIncrement}` : '';\n    const pkString = primaryKeys.map(pk => this.quoteIdentifier(pk)).join(', ');\n\n    if (options.uniqueKeys) {\n      _.each(options.uniqueKeys, (columns, indexName) => {\n        if (columns.customIndex) {\n          if (typeof indexName !== 'string') {\n            indexName = `uniq_${tableName}_${columns.fields.join('_')}`;\n          }\n          attributesClause += `, UNIQUE ${this.quoteIdentifier(indexName)} (${columns.fields.map(field => this.quoteIdentifier(field)).join(', ')})`;\n        }\n      });\n    }\n\n    if (pkString.length > 0) {\n      attributesClause += `, PRIMARY KEY (${pkString})`;\n    }\n\n    for (const fkey in foreignKeys) {\n      if (Object.prototype.hasOwnProperty.call(foreignKeys, fkey)) {\n        attributesClause += `, FOREIGN KEY (${this.quoteIdentifier(fkey)}) ${foreignKeys[fkey]}`;\n      }\n    }\n\n    return `CREATE TABLE IF NOT EXISTS ${table} (${attributesClause}) ENGINE=${engine}${comment}${charset}${collation}${initialAutoIncrement}${rowFormat};`;\n  }\n\n\n  describeTableQuery(tableName, schema, schemaDelimiter) {\n    const table = this.quoteTable(\n      this.addSchema({\n        tableName,\n        _schema: schema,\n        _schemaDelimiter: schemaDelimiter\n      })\n    );\n\n    return `SHOW FULL COLUMNS FROM ${table};`;\n  }\n\n  showTablesQuery(database) {\n    let query = 'SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = \\'BASE TABLE\\'';\n    if (database) {\n      query += ` AND TABLE_SCHEMA = ${this.escape(database)}`;\n    } else {\n      query += ' AND TABLE_SCHEMA NOT IN (\\'MYSQL\\', \\'INFORMATION_SCHEMA\\', \\'PERFORMANCE_SCHEMA\\', \\'SYS\\')';\n    }\n    return `${query};`;\n  }\n\n  addColumnQuery(table, key, dataType) {\n    const definition = this.attributeToSQL(dataType, {\n      context: 'addColumn',\n      tableName: table,\n      foreignKey: key\n    });\n\n    return `ALTER TABLE ${this.quoteTable(table)} ADD ${this.quoteIdentifier(key)} ${definition};`;\n  }\n\n  removeColumnQuery(tableName, attributeName) {\n    return `ALTER TABLE ${this.quoteTable(tableName)} DROP ${this.quoteIdentifier(attributeName)};`;\n  }\n\n  changeColumnQuery(tableName, attributes) {\n    const attrString = [];\n    const constraintString = [];\n\n    for (const attributeName in attributes) {\n      let definition = attributes[attributeName];\n      if (definition.includes('REFERENCES')) {\n        const attrName = this.quoteIdentifier(attributeName);\n        definition = definition.replace(/.+?(?=REFERENCES)/, '');\n        constraintString.push(`FOREIGN KEY (${attrName}) ${definition}`);\n      } else {\n        attrString.push(`\\`${attributeName}\\` \\`${attributeName}\\` ${definition}`);\n      }\n    }\n\n    let finalQuery = '';\n    if (attrString.length) {\n      finalQuery += `CHANGE ${attrString.join(', ')}`;\n      finalQuery += constraintString.length ? ' ' : '';\n    }\n    if (constraintString.length) {\n      finalQuery += `ADD ${constraintString.join(', ')}`;\n    }\n\n    return `ALTER TABLE ${this.quoteTable(tableName)} ${finalQuery};`;\n  }\n\n  renameColumnQuery(tableName, attrBefore, attributes) {\n    const attrString = [];\n\n    for (const attrName in attributes) {\n      const definition = attributes[attrName];\n      attrString.push(`\\`${attrBefore}\\` \\`${attrName}\\` ${definition}`);\n    }\n\n    return `ALTER TABLE ${this.quoteTable(tableName)} CHANGE ${attrString.join(', ')};`;\n  }\n\n  handleSequelizeMethod(smth, tableName, factory, options, prepend) {\n    if (smth instanceof Utils.Json) {\n      // Parse nested object\n      if (smth.conditions) {\n        const conditions = this.parseConditionObject(smth.conditions).map(condition =>\n          `${this.jsonPathExtractionQuery(condition.path[0], _.tail(condition.path))} = '${condition.value}'`\n        );\n\n        return conditions.join(' AND ');\n      }\n      if (smth.path) {\n        let str;\n\n        // Allow specifying conditions using the sqlite json functions\n        if (this._checkValidJsonStatement(smth.path)) {\n          str = smth.path;\n        } else {\n          // Also support json property accessors\n          const paths = _.toPath(smth.path);\n          const column = paths.shift();\n          str = this.jsonPathExtractionQuery(column, paths);\n        }\n\n        if (smth.value) {\n          str += util.format(' = %s', this.escape(smth.value));\n        }\n\n        return str;\n      }\n    } else if (smth instanceof Utils.Cast) {\n      if (/timestamp/i.test(smth.type)) {\n        smth.type = 'datetime';\n      } else if (smth.json && /boolean/i.test(smth.type)) {\n        // true or false cannot be casted as booleans within a JSON structure\n        smth.type = 'char';\n      } else if (/double precision/i.test(smth.type) || /boolean/i.test(smth.type) || /integer/i.test(smth.type)) {\n        smth.type = 'decimal';\n      } else if (/text/i.test(smth.type)) {\n        smth.type = 'char';\n      }\n    }\n\n    return super.handleSequelizeMethod(smth, tableName, factory, options, prepend);\n  }\n\n  _toJSONValue(value) {\n    // true/false are stored as strings in mysql\n    if (typeof value === 'boolean') {\n      return value.toString();\n    }\n    // null is stored as a string in mysql\n    if (value === null) {\n      return 'null';\n    }\n    return value;\n  }\n\n  upsertQuery(tableName, insertValues, updateValues, where, model, options) {\n    options.onDuplicate = 'UPDATE ';\n\n    options.onDuplicate += Object.keys(updateValues).map(key => {\n      key = this.quoteIdentifier(key);\n      return `${key}=VALUES(${key})`;\n    }).join(', ');\n\n    return this.insertQuery(tableName, insertValues, model.rawAttributes, options);\n  }\n\n  truncateTableQuery(tableName) {\n    return `TRUNCATE ${this.quoteTable(tableName)}`;\n  }\n\n  deleteQuery(tableName, where, options = {}, model) {\n    let limit = '';\n    let query = `DELETE FROM ${this.quoteTable(tableName)}`;\n\n    if (options.limit) {\n      limit = ` LIMIT ${this.escape(options.limit)}`;\n    }\n\n    where = this.getWhereConditions(where, null, model, options);\n\n    if (where) {\n      query += ` WHERE ${where}`;\n    }\n\n    return query + limit;\n  }\n\n  showIndexesQuery(tableName, options) {\n    return `SHOW INDEX FROM ${this.quoteTable(tableName)}${(options || {}).database ? ` FROM \\`${options.database}\\`` : ''}`;\n  }\n\n  showConstraintsQuery(table, constraintName) {\n    const tableName = table.tableName || table;\n    const schemaName = table.schema;\n\n    let sql = [\n      'SELECT CONSTRAINT_CATALOG AS constraintCatalog,',\n      'CONSTRAINT_NAME AS constraintName,',\n      'CONSTRAINT_SCHEMA AS constraintSchema,',\n      'CONSTRAINT_TYPE AS constraintType,',\n      'TABLE_NAME AS tableName,',\n      'TABLE_SCHEMA AS tableSchema',\n      'from INFORMATION_SCHEMA.TABLE_CONSTRAINTS',\n      `WHERE table_name='${tableName}'`\n    ].join(' ');\n\n    if (constraintName) {\n      sql += ` AND constraint_name = '${constraintName}'`;\n    }\n\n    if (schemaName) {\n      sql += ` AND TABLE_SCHEMA = '${schemaName}'`;\n    }\n\n    return `${sql};`;\n  }\n\n  removeIndexQuery(tableName, indexNameOrAttributes) {\n    let indexName = indexNameOrAttributes;\n\n    if (typeof indexName !== 'string') {\n      indexName = Utils.underscore(`${tableName}_${indexNameOrAttributes.join('_')}`);\n    }\n\n    return `DROP INDEX ${this.quoteIdentifier(indexName)} ON ${this.quoteTable(tableName)}`;\n  }\n\n  attributeToSQL(attribute, options) {\n    if (!_.isPlainObject(attribute)) {\n      attribute = {\n        type: attribute\n      };\n    }\n\n    const attributeString = attribute.type.toString({ escape: this.escape.bind(this) });\n    let template = attributeString;\n\n    if (attribute.allowNull === false) {\n      template += ' NOT NULL';\n    }\n\n    if (attribute.autoIncrement) {\n      template += ' auto_increment';\n    }\n\n    // BLOB/TEXT/GEOMETRY/JSON cannot have a default value\n    if (!typeWithoutDefault.has(attributeString)\n      && attribute.type._binary !== true\n      && Utils.defaultValueSchemable(attribute.defaultValue)) {\n      template += ` DEFAULT ${this.escape(attribute.defaultValue)}`;\n    }\n\n    if (attribute.unique === true) {\n      template += ' UNIQUE';\n    }\n\n    if (attribute.primaryKey) {\n      template += ' PRIMARY KEY';\n    }\n\n    if (attribute.comment) {\n      template += ` COMMENT ${this.escape(attribute.comment)}`;\n    }\n\n    if (attribute.first) {\n      template += ' FIRST';\n    }\n    if (attribute.after) {\n      template += ` AFTER ${this.quoteIdentifier(attribute.after)}`;\n    }\n\n    if (attribute.references) {\n\n      if (options && options.context === 'addColumn' && options.foreignKey) {\n        const attrName = this.quoteIdentifier(options.foreignKey);\n        const fkName = this.quoteIdentifier(`${options.tableName}_${attrName}_foreign_idx`);\n\n        template += `, ADD CONSTRAINT ${fkName} FOREIGN KEY (${attrName})`;\n      }\n\n      template += ` REFERENCES ${this.quoteTable(attribute.references.model)}`;\n\n      if (attribute.references.key) {\n        template += ` (${this.quoteIdentifier(attribute.references.key)})`;\n      } else {\n        template += ` (${this.quoteIdentifier('id')})`;\n      }\n\n      if (attribute.onDelete) {\n        template += ` ON DELETE ${attribute.onDelete.toUpperCase()}`;\n      }\n\n      if (attribute.onUpdate) {\n        template += ` ON UPDATE ${attribute.onUpdate.toUpperCase()}`;\n      }\n    }\n\n    return template;\n  }\n\n  attributesToSQL(attributes, options) {\n    const result = {};\n\n    for (const key in attributes) {\n      const attribute = attributes[key];\n      result[attribute.field || key] = this.attributeToSQL(attribute, options);\n    }\n\n    return result;\n  }\n\n  /**\n   * Check whether the statmement is json function or simple path\n   *\n   * @param   {string}  stmt  The statement to validate\n   * @returns {boolean}       true if the given statement is json function\n   * @throws  {Error}         throw if the statement looks like json function but has invalid token\n   * @private\n   */\n  _checkValidJsonStatement(stmt) {\n    if (typeof stmt !== 'string') {\n      return false;\n    }\n\n    let currentIndex = 0;\n    let openingBrackets = 0;\n    let closingBrackets = 0;\n    let hasJsonFunction = false;\n    let hasInvalidToken = false;\n\n    while (currentIndex < stmt.length) {\n      const string = stmt.substr(currentIndex);\n      const functionMatches = jsonFunctionRegex.exec(string);\n      if (functionMatches) {\n        currentIndex += functionMatches[0].indexOf('(');\n        hasJsonFunction = true;\n        continue;\n      }\n\n      const operatorMatches = jsonOperatorRegex.exec(string);\n      if (operatorMatches) {\n        currentIndex += operatorMatches[0].length;\n        hasJsonFunction = true;\n        continue;\n      }\n\n      const tokenMatches = tokenCaptureRegex.exec(string);\n      if (tokenMatches) {\n        const capturedToken = tokenMatches[1];\n        if (capturedToken === '(') {\n          openingBrackets++;\n        } else if (capturedToken === ')') {\n          closingBrackets++;\n        } else if (capturedToken === ';') {\n          hasInvalidToken = true;\n          break;\n        }\n        currentIndex += tokenMatches[0].length;\n        continue;\n      }\n\n      break;\n    }\n\n    // Check invalid json statement\n    if (hasJsonFunction && (hasInvalidToken || openingBrackets !== closingBrackets)) {\n      throw new Error(`Invalid json statement: ${stmt}`);\n    }\n\n    // return true if the statement has valid json function\n    return hasJsonFunction;\n  }\n\n  /**\n   * Generates an SQL query that returns all foreign keys of a table.\n   *\n   * @param  {Object} table  The table.\n   * @param  {string} schemaName The name of the schema.\n   * @returns {string}            The generated sql query.\n   * @private\n   */\n  getForeignKeysQuery(table, schemaName) {\n    const tableName = table.tableName || table;\n    return `SELECT ${foreignKeyFields} FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE where TABLE_NAME = '${tableName}' AND CONSTRAINT_NAME!='PRIMARY' AND CONSTRAINT_SCHEMA='${schemaName}' AND REFERENCED_TABLE_NAME IS NOT NULL;`;\n  }\n\n  /**\n   * Generates an SQL query that returns the foreign key constraint of a given column.\n   *\n   * @param  {Object} table  The table.\n   * @param  {string} columnName The name of the column.\n   * @returns {string}            The generated sql query.\n   * @private\n   */\n  getForeignKeyQuery(table, columnName) {\n    const quotedSchemaName = table.schema ? wrapSingleQuote(table.schema) : '';\n    const quotedTableName = wrapSingleQuote(table.tableName || table);\n    const quotedColumnName = wrapSingleQuote(columnName);\n\n    return `SELECT ${foreignKeyFields} FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE`\n      + ` WHERE (REFERENCED_TABLE_NAME = ${quotedTableName}${table.schema\n        ? ` AND REFERENCED_TABLE_SCHEMA = ${quotedSchemaName}`\n        : ''} AND REFERENCED_COLUMN_NAME = ${quotedColumnName})`\n      + ` OR (TABLE_NAME = ${quotedTableName}${table.schema ?\n        ` AND TABLE_SCHEMA = ${quotedSchemaName}` : ''} AND COLUMN_NAME = ${quotedColumnName} AND REFERENCED_TABLE_NAME IS NOT NULL)`;\n  }\n\n  /**\n   * Generates an SQL query that removes a foreign key from a table.\n   *\n   * @param  {string} tableName  The name of the table.\n   * @param  {string} foreignKey The name of the foreign key constraint.\n   * @returns {string}            The generated sql query.\n   * @private\n   */\n  dropForeignKeyQuery(tableName, foreignKey) {\n    return `ALTER TABLE ${this.quoteTable(tableName)}\n      DROP FOREIGN KEY ${this.quoteIdentifier(foreignKey)};`;\n  }\n}\n\n// private methods\nfunction wrapSingleQuote(identifier) {\n  return Utils.addTicks(identifier, '\\'');\n}\n\nmodule.exports = MySQLQueryGenerator;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}